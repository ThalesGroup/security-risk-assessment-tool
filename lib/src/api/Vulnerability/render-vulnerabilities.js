/*----------------------------------------------------------------------------
*
*     Copyright Â© 2022 THALES. All Rights Reserved.
 *
* -----------------------------------------------------------------------------
* THALES MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF
* THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED
 * TO THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE, OR NON-INFRINGEMENT. THALES SHALL NOT BE
 * LIABLE FOR ANY DAMAGES SUFFERED BY LICENSEE AS A RESULT OF USING,
 * MODIFYING OR DISTRIBUTING THIS SOFTWARE OR ITS DERIVATIVES.
*
* THIS SOFTWARE IS NOT DESIGNED OR INTENDED FOR USE OR RESALE AS ON-LINE
* CONTROL EQUIPMENT IN HAZARDOUS ENVIRONMENTS REQUIRING FAIL-SAFE
* PERFORMANCE, SUCH AS IN THE OPERATION OF NUCLEAR FACILITIES, AIRCRAFT
* NAVIGATION OR COMMUNICATION SYSTEMS, AIR TRAFFIC CONTROL, DIRECT LIFE
* SUPPORT MACHINES, OR WEAPONS SYSTEMS, IN WHICH THE FAILURE OF THE
* SOFTWARE COULD LEAD DIRECTLY TO DEATH, PERSONAL INJURY, OR SEVERE
* PHYSICAL OR ENVIRONMENTAL DAMAGE ("HIGH RISK ACTIVITIES"). THALES
* SPECIFICALLY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTY OF FITNESS FOR
* HIGH RISK ACTIVITIES.
* -----------------------------------------------------------------------------
*/
const vulnerabilityJsonSchema = require('../../model/schema/json-schema').properties.Vulnerability.items.properties;
const vulnerabilityFamily = vulnerabilityJsonSchema.vulnerabilityFamily.enum;

const renderVulnerabilities = () => {
  let vulnerabilityFamilyOptions = '';
    vulnerabilityFamily.forEach((option) => {
      if (option === '') vulnerabilityFamilyOptions += `<option value="${option}">Select...</option>`;
      else vulnerabilityFamilyOptions += `<option value="${option}">${option}</option>`;
    });

    const html = `
                <header>Vulnerabilities</header>

                <p class="subheading">List of Identified Vulnerabilities</p>
                <p class="summary">A vulnerability is any security breach or weakness (of a supporting asset), which
                can be exploited by a Threat Agent (to compromise a business asset).</p>
                <div class='filter' style="display: flex;">
                  <input id="filter-value" type="text" placeholder="Filter..." style="width: 100%">
                  <button id="filter-clear">X</button>
                </div>
                <div class="table">
                    <div id="vulnerabilties__table"></div>
                </div>
                <div class="add-delete-container">
                    <button class="addDelete">Add</button> | <button class="addDelete">Delete</button>
                </div>
                
                <section>
                    <div>
                        <h1>Vulnerability description</h1>
                        <h1>Vulnerability Id: <span id="vulnerabilityId"></span></h1>
                    </div>
                    <div>
                        <label for="vulnerability__name">Vulnerability Name:</label>
                        <input type="text" name="vulnerability__name" id="vulnerability__name">
                        <div class="vulnerabilities__flexbox">
                            <div>
                                <label for="vulnerability__trackingID">Defect ID:</label>
                                <input type="text" name="vulnerability__trackingID" id="vulnerability__trackingID">
                            </div>
                            <div>
                                <label for="vulnerability__url--hyperlink">Defect URL:</label>
                                <div class='hyperlink-attachment-align'>
                                    <img class='hyperlink-attachment-image' id="vulnerability__url--img" src="../../asset/link.png"
                                        alt="Hyperlink:">
                                    <a id="vulnerability__url--insert">Click here to insert a hyperlink</a>
                                    <a id="vulnerability__url--hyperlink" href=" " hidden></a>
                                </div>
                            </div>
                        </div>
                
                        <label for="vulnerability__family">Vulnerability Family:</label>
                        <select name="vulnerability__family" id="vulnerability__family">
                           ${vulnerabilityFamilyOptions}
                        </select>
                
                        <div>
                            <label for="vulnerability__details">Vulnerability Description:</label>
                            <div class="btn btn-primary tooltip">
                              <textarea class="rich-text" id="vulnerability__details" cols="30" rows="20"></textarea>
                              <div class="top">
                                <p>${vulnerabilityJsonSchema.vulnerabilityDescription.description}</p>
                                <i></i>
                              </div>
                            </div>  
                        </div>
                
                        <div id="vulnerability__attachment">
                            <div class='hyperlink-attachment-align'>
                                <img class='hyperlink-attachment-image' id="vulnerability__file-image" src="../../asset/link.png"
                                    alt="File:">
                                <a id="vulnerability__file--insert">Click here to attach a file</a>
                            </div>
                        </div>

                        <div class="select__refs">
                            <label for="vulnerability__supporting-assets-refs">Supporting Asset <span>potentially affected by this vulnerability:</span></label>
                            <div class="refs"></div>
                        </div>

                        <div>
                            <label for="vulnerability__CVE">Vulnerability CVE:</label>
                            <input type="text" name="vulnerability__CVE" id="vulnerability__CVE">
                        </div>

                        <div class="score">
                            <div>
                                <label for="vulnerability__scoring">CVE Official CVSS Score:</label>
                                <input type="number" id="vulnerability__scoring" name="vulnerability__scoring" min="0" max="10")?$"><span> <strong>/10<strong><span>
                            </div>
                            <p>Vulnerability Scoring: <strong id="vulnerability__scoring__round"></strong>/10</p>
                            <p>Vulnerability Level: <span id="vulnerability__level"></span></p>
                        </div>
                    </div>
                </section>
        
                <footer></footer>
    `;
    const tableOptions = {
      selectable: 1,
      layout: 'fitColumns',
      height: '100%',
      index: 'vulnerabilityId',
      columns: [ // Define Table Columns
        {
          title: 'Delete?', field: 'Vuln. Checkbox', headerSort: false, headerHozAlign: 'center', hozAlign: 'center', headerWordWrap: true, width: 80
        },
        {
          title: 'Vuln. Id', field: 'vulnerabilityId', width: 100, headerSort: false, headerHozAlign: 'center', hozAlign: 'center', headerWordWrap: true
        },
        {
          title: 'Project Version', field: 'projectVersion', headerSort: false, headerHozAlign: 'center', hozAlign: 'center', headerWordWrap: true
        },
        {
          title: 'Vuln. Name', field: 'vulnerabilityName', headerSort: false, headerHozAlign: 'center', width: 480
        },
        {
          title: 'Vuln. Level', field: 'overallLevel', headerSort: false, headerHozAlign: 'center', hozAlign: 'center', headerWordWrap: true
        },
      ],
    };
    return [html, tableOptions];
  };
  
  module.exports = {
    renderVulnerabilities,
  };